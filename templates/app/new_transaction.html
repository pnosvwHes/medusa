{% extends "app/base.html" %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="max-w-4xl mx-auto p-4 bg-white rounded-xl shadow-md my-8">
  <h1 class="text-2xl font-bold text-center mb-6 text-gray-800">ثبت پرداخت جدید</h1>
  
  <form method="POST" id="payForm" class="space-y-6">
    {% csrf_token %}
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="space-y-4">
        <div class="form-group">
          <label for="{{ form.date.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
            {{ form.date.label }}
          </label>
          {{ form.date }}
        </div>

        <div class="form-group">
          <label for="{{ form.pay_type.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
            {{ form.pay_type.label }}
          </label>
          {{ form.pay_type }}
        </div>

        <div class="form-group" id="personnelField">
          <label for="{{ form.personnel.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
            {{ form.personnel.label }}
          </label>
          {{ form.personnel }}
        </div>

        <div class="form-group">
          <label for="{{ form.bank.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
            {{ form.bank.label }}
          </label>
          {{ form.bank }}
        </div>
      </div>

      <div class="space-y-4">
        <div class="form-group">
          <label for="{{ form.amount.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
            {{ form.amount.label }}
          </label>
          {{ form.amount }}
        </div>

        <div class="form-group">
          <label for="{{ form.source_type.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
            {{ form.source_type.label }}
          </label>
          {{ form.source_type }}
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="{{ form.description.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
        {{ form.description.label }}
      </label>
      {{ form.description }}
    </div>

    <div class="flex justify-end space-x-4 pt-4">
      <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition duration-200">
        ذخیره پرداخت
      </button>
      <a href="{% url 'home' %}" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded-lg transition duration-200">
        انصراف
      </a>
    </div>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const payTypeSelect = document.getElementById("id_pay_type");
  const personnelField = document.getElementById("personnelField");

  function togglePersonnel() {
    const selectedOption = payTypeSelect.options[payTypeSelect.selectedIndex];
    // بررسی data attribute که از فرم اضافه می‌کنیم (یا استفاده از فلگ is_personnel)
    if (selectedOption.dataset.isPersonnel === "true") {
      personnelField.style.display = "block";
    } else {
      personnelField.style.display = "none";
      const personnelInput = personnelField.querySelector("select");
      if(personnelInput) personnelInput.value = "";
    }
  }

  togglePersonnel();
  payTypeSelect.addEventListener("change", togglePersonnel);
});
</script>
{% endblock %}
