{% extends 'app/base.html' %}
{% load humanize %}
{% load jalali_tags %}

{% block content %}
<div class="max-w-6xl mx-auto p-6">

    <!-- Ù‡Ø¯Ø± -->
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold text-gray-800">Ù„ÛŒØ³Øª Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§</h2>
        <a href="{% url 'create_pay' %}" 
           class="bg-indigo-500 text-white px-4 py-2 rounded-xl shadow hover:bg-indigo-600 transition text-sm">
           Ù¾Ø±Ø¯Ø§Ø®Øª Ø¬Ø¯ÛŒØ¯
        </a>
    </div>

    <!-- ÙØ±Ù… ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ® -->
    <form method="get" class="mb-6 bg-white shadow-md rounded-2xl border border-gray-200 p-4 flex flex-wrap items-end gap-4">
        <div>
            <label for="from_date" class="block text-sm font-medium text-gray-600">Ø§Ø² ØªØ§Ø±ÛŒØ®</label>
            <input type="text" id="from_date" name="from_date" 
                   value="{{ from_date|default_if_none:'' }}"
                   class="datepicker border rounded-lg px-3 py-2 w-40 text-sm focus:ring focus:ring-blue-300">
        </div>
        <div>
            <label for="to_date" class="block text-sm font-medium text-gray-600">ØªØ§ ØªØ§Ø±ÛŒØ®</label>
            <input type="text" id="to_date" name="to_date" 
                   value="{{ to_date|default_if_none:'' }}"
                   class="datepicker border rounded-lg px-3 py-2 w-40 text-sm focus:ring focus:ring-blue-300">
        </div>
        <div>
            <button type="submit" 
                class="bg-indigo-500 text-white px-5 py-2 rounded-xl shadow hover:bg-indigo-600 transition">
                ÙÛŒÙ„ØªØ±
            </button>
        </div>
    </form>

    <!-- ğŸ–¥ Ø¯Ø³Ú©ØªØ§Ù¾: Ø¬Ø¯ÙˆÙ„ -->
    <div class="hidden md:block overflow-x-auto bg-white shadow-md rounded-2xl border border-gray-200">
        <table class="w-full text-sm text-right text-gray-700">
            <thead class="bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-lg">
                <tr>
                    <th class="px-4 py-3 text-center">ØªØ§Ø±ÛŒØ®</th>
                    <th class="px-4 py-3 text-center">Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª</th>
                    <th class="px-4 py-3 text-center">Ù¾Ø±Ø³Ù†Ù„</th>
                    <th class="px-4 py-3 text-center">Ù…Ø¨Ù„Øº</th>
                    <th class="px-4 py-3 text-center">Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©ÛŒ</th>
                    <th class="px-4 py-3 text-center">ØªÙˆØ¶ÛŒØ­Ø§Øª</th>
                    <th class="px-4 py-3 text-center">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% for pay in pays %}
                <tr class="hover:bg-gray-50 transition">
                    <td class="px-4 py-3 text-gray-600">{{ pay.date|to_jalali:'%Y/%m/%d' }}</td>
                    <td class="px-4 py-3">{{ pay.pay_type }}</td>
                    <td class="px-4 py-3">{{ pay.personnel|default_if_none:"-" }}</td>
                    <td class="px-4 py-3 font-semibold text-indigo-600">{{ pay.amount|intcomma }}</td>
                    <td class="px-4 py-3">{{ pay.bank|default_if_none:"Ù†Ù‚Ø¯" }}</td>
                    <td class="px-4 py-3 text-gray-500">{{ pay.description|default_if_none:"" }}</td>
                    <td class="px-4 py-3 flex justify-center gap-3">
                        <a href="{% url 'update_pay' pay.id %}" class="text-blue-500 hover:text-blue-700">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'delete_pay' pay.id %}" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="text-center py-6 text-gray-500">
                        Ù‡ÛŒÚ† Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª âœ¨
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- ğŸ“± Ù…ÙˆØ¨Ø§ÛŒÙ„: Ú©Ø§Ø±Øª -->
    <div class="md:hidden space-y-3">
        {% for pay in pays %}
        <div class="relative bg-white shadow rounded-lg border border-gray-200 overflow-hidden">

            <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
            <div class="absolute inset-y-0 right-0 flex flex-col items-center justify-center gap-2 px-2 bg-white z-10 swipe-actions hidden">
                <a href="{% url 'update_pay' pay.id %}" class="bg-blue-500 text-white px-3 py-1 rounded-lg shadow text-sm w-20 text-center">ÙˆÛŒØ±Ø§ÛŒØ´</a>
                <a href="{% url 'delete_pay' pay.id %}" class="bg-red-500 text-white px-3 py-1 rounded-lg shadow text-sm w-20 text-center">Ø­Ø°Ù</a>
            </div>

            <!-- Ú©Ø§Ø±Øª -->
            <div class="swipe-card relative bg-white p-3 transition-transform duration-300">
                <!-- Ø¨Ø§Ù„Ø§: ØªØ§Ø±ÛŒØ® Ùˆ Ø¨Ø§Ù†Ú© -->
                <div class="flex justify-between items-center text-sm mb-2">
                    <span class="text-gray-500">{{ pay.date|to_jalali:'%Y/%m/%d' }}</span>
                    <span class="px-2 py-0.5 text-xs rounded-full border border-gray-300 bg-gray-50 text-gray-700">
                        {% if pay.bank %}{{ pay.bank.name }}{% else %}Ù†Ù‚Ø¯{% endif %}
                    </span>
                </div>

                <!-- ÙˆØ³Ø·: Ù¾Ø±Ø³Ù†Ù„ ÛŒØ§ Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª -->
                <div class="text-gray-800 font-semibold text-base mb-2">
                    {% if pay.pay_type.is_personnel and pay.personnel %}{{ pay.personnel }}{% else %}{{ pay.pay_type }}{% endif %}
                </div>

                <!-- Ù¾Ø§ÛŒÛŒÙ†: Ù…Ø¨Ù„Øº -->
                <div class="text-indigo-600 font-bold text-xl">
                    {{ pay.amount|intcomma }}
                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-center py-6 text-gray-500">Ù‡ÛŒÚ† Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª âœ¨</p>
        {% endfor %}
    </div>

</div>
{% endblock %}

{% block extra_scripts %}
<script>
$(document).ready(function() {
    $('.select2').select2({ width: '100%', minimumResultsForSearch: 8 });
    $('.datepicker').persianDatepicker({ format: 'YYYY/MM/DD', autoClose: true });

    let activeCard = null;

    $(".swipe-card").each(function () {
        let card = $(this);
        let startX = 0;
        let currentX = 0;

        card.on("touchstart", function (e) {
            startX = e.touches[0].clientX;
            if(activeCard && activeCard[0] !== card[0]){
                activeCard.css("transform", "translateX(0)");
                activeCard.siblings('.swipe-actions').addClass("hidden");
                activeCard = null;
            }
        });

        card.on("touchmove", function (e) {
            currentX = e.touches[0].clientX - startX;
            if (currentX < 0) {
                card.css("transform", `translateX(${currentX}px)`);
            }
        });

        card.on("touchend", function () {
            if (currentX < -60) {
                // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† ÙÙ†Ø±ÛŒ
                card.css("transition", "transform 0.3s cubic-bezier(0.25, 1.5, 0.5, 1)");
                card.css("transform", "translateX(-110px)");
                card.siblings('.swipe-actions').removeClass("hidden");
                activeCard = card;
                setTimeout(() => card.css("transition", "transform 0.3s ease"), 300);
            } else {
                card.css("transition", "transform 0.3s cubic-bezier(0.25, 1.5, 0.5, 1)");
                card.css("transform", "translateX(0)");
                card.siblings('.swipe-actions').addClass("hidden");
                activeCard = null;
                setTimeout(() => card.css("transition", "transform 0.3s ease"), 300);
            }
        });
    });
});
</script>
{% endblock %}
